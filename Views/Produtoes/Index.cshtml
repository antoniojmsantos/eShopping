@model IEnumerable<TP_PWEB.Models.Produto>

@{
	ViewBag.Title = "Catálogo de Produtos";
}

<h2>Catálogo de Produtos</h2>

@if (User.IsInRole("Empresa"))
{
	<p>
		@Html.ActionLink("Registar Produto", "Create", null, new { @class = "btn btn-primary" })
	</p>
}
else if (User.IsInRole("Cliente"))
{

	using (Html.BeginForm("Index", "Produtoes", FormMethod.Get))
	{
		<hr />
		<div class="form-horizontal">
			<div class="form-group">
				<label class="control-label col-md-2">Produto</label>
				<div class="col-md-10">
					<input name="produto" value="@ViewBag.Produto" class="form-control" />
				</div>
			</div>

			<div class="form-group">
				<label class="control-label col-md-2">Categoria</label>
				<div class="col-md-10">
					@Html.DropDownList("IdCategoria", null, htmlAttributes: new { @class = "form-control" })
				</div>
			</div>
		</div>

		<div class="form-group">
			<div class="col-md-offset-2 col-md-10">
				<input type="submit" value="Pesquisar" class="btn btn-primary" />
			</div>
		</div>
	}
}
<table class="table">
	<tr>
		<th>
			Produto
		</th>
		<th>
			Categoria
		</th>
		<th>
			Vendido por
		</th>
		<th>
			@Html.DisplayNameFor(model => model.EmStock)
		</th>
		<th>
			@Html.DisplayNameFor(model => model.UnidadesEmStock)
		</th>
		<th>
			@Html.DisplayNameFor(model => model.Preco)
		</th>
		<th></th>
	</tr>
	@if (Model.Count() == 0)
	{
		<tr>
			<td colspan="5">Não existem registos correspondentes aos critérios mencionados.</td>
		</tr>
	}
	@foreach (var item in Model)
	{
		<tr>
			<td>
				@Html.DisplayFor(modelItem => item.Nome)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.Categoria.NomeCategoria)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.Empresa.NomeEmpresa)
			</td>
			<td>
				@if (item.EmStock)
				{
					<p style="color: green;">Sim</p>
				}
				else
				{
					<p style="color: red;">Não</p>
				}
			</td>
			<td>
				x @Html.DisplayFor(modelItem => item.UnidadesEmStock)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.Preco)
			</td>

			@if (User.IsInRole("Cliente"))
			{
				<td>
					@Html.ActionLink("Details", "Details", new { id = item.IdProduto }, new { @class = "btn btn-default" })

					@if (item.EmStock)
					{
						@Html.ActionLink(
							linkText: "Adicionar ao carrinho",
							actionName: "AdicionarItem",
							controllerName: "Carrinho",
							routeValues: new
							{
								id = item.IdProduto
							},
							htmlAttributes: new
								 {
								@class = "btn btn-primary"
							})
					}
					else
					{
						// button is disabled
					}

				</td>
			}

			@if (User.IsInRole("Funcionario"))
			{
				// criar promoção
				<td>
					@Html.ActionLink("Ver", "Details", new { id = item.IdProduto }, new { @class = "btn btn-default" })
				</td>
			}

			@if (User.IsInRole("Empresa"))
			{
				<td>
					@Html.ActionLink("Editar", "Edit", new { id = item.IdProduto }, new { @class = "btn btn-default" })
					@Html.ActionLink("Detalhes", "Details", new { id = item.IdProduto }, new { @class = "btn btn-default" })
					@Html.ActionLink("Apagar", "Delete", new { id = item.IdProduto }, new { @class = "btn btn-default" })
				</td>
			}
		</tr>
	}
</table>
